[
  {
    "objectID": "counting_dispensaries_step1.html#nimbys-method",
    "href": "counting_dispensaries_step1.html#nimbys-method",
    "title": "replicating nimby",
    "section": "NIMBY’s Method:",
    "text": "NIMBY’s Method:\n\nThe data on dispensary locations come from the Colorado Department of Revenue, which starting in January 2013 has published a monthly list of each active medical and recreational license. Overall, our sample covers 48 months between 2013 and 2016 for 143 census tracts in the City of Denver.\n[@brinkman2017]\n\nNIMBY’s data were accessed at the no longer active Colorado.gov page: in January 2017."
  },
  {
    "objectID": "counting_dispensaries_step1.html#my-method",
    "href": "counting_dispensaries_step1.html#my-method",
    "title": "replicating nimby",
    "section": "My Method:",
    "text": "My Method:\nData Source: Colorado Department of Revenue: Medical and Retail Marijuana Licencees\nAccessed April 2023\nBefore running the code below, I downloaded the dispensary files from the Colorado Department of Revenue’s monthly list of med licensee data archive, and manually adjusted the naming convention to reflect the file’s time period.\n\n\n\ninstall packages:\n\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0     ✔ purrr   1.0.1\n✔ tibble  3.2.1     ✔ dplyr   1.1.1\n✔ tidyr   1.2.1     ✔ stringr 1.5.0\n✔ readr   2.1.3     ✔ forcats 0.5.2\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\nAttaching package: 'lubridate'\n\n\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n\n\n\n\ncombine files into a single dataframe, with a new date field:\nadapted from “Pass chunk of filename to column name in a loop”\n\n\nCode\n# set working directory for this chunk only\nsetwd(\"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/dsp_data\")\ndsp <- dir_ls() %>% set_names() # grab all of the file names \n\n#  the .id parameter creates a new column called \"filename\" \nall_dsps <- map_df(dsp, ~read_excel(.x), .id = \"filename\")\n\n\nNew names:\nNew names:\nNew names:\n• `` -> `...8`\n\n\nCode\n# extract the date from the file name and create a new date column\nall_dsps <- all_dsps %>% \n  mutate(date = str_extract(filename, \"\\\\d{6}\"),\n         date = as.Date(paste0(\"01\", date), format = \"%d%m%Y\"))\n\n\n\n\n\n\ncreate uniform observation fields:\nThe ledgers vary throughout the years. In order to create a cohesive database, I needed to ensure like fields held the same naming conventions so they can be aggregated together down the road.\n\n\n\ndispensary record fields:\n\n\n\n\n\ncity\ndba (doing business as)\n\n\nlicensee\nlicense number\n\n\nzip code\n\n\n\n\nadapted from “How to Use the coalesce() Function in dplyr”\n\n\nCode\n# use coalesce to combine like columns and override the N/A\nall_dsps<-  all_dsps %>% \n  mutate(dba = coalesce(DBA,`DOING BUSINESS AS`)) %>% \n  mutate(city = coalesce(CITY, City)) %>% \n  mutate(licensee = coalesce(Licensee, Licensees, LICENSEE, `Licensee Name` )) %>% \n  mutate(zip = coalesce(ZIP, Zip, ZipCode)) %>% \n  mutate(license_no = coalesce(`Lic #`,`LICENSE #`, `License Number`,LicenseNumber, license_no, `License #` )) \n\n #make a year column / variable\nall_dsps$year <- substr(all_dsps$date, 1,4)\n\n# write.csv(all_dsps, \"firstbatch.csv\")\n\n# select the relevant fields\nall_dsps <- all_dsps %>%\n  select(1, 26, 37:42)\n\n\n\n\n\n\ncreate uniform business names\nAnother inconsistent feature of the ledger includes many variations in the spelling of a business name. Throughout this project, I became vary familiar with the cannabis related business names and puns. I assume that if a similarly spelled business holds the same licence number, I can override that name to reflect the predominant naming convention. This tedious task was crucial in allowing me to match businesses that sell both medial and recreational products under different licenses.\n\n\nCode\n# same case\nall_dsps$dba <- toupper(all_dsps$dba) # DBA = \"Doing Business As\"\n\n# replace chaotic naming conventions\nall_dsps$dba <- gsub(\"3D CENTER\",\"3D CANNABIS CENTER\", all_dsps$dba)\nall_dsps$dba <- gsub(\"3D CANNABIS CENTER AND 3D DISPENSARY\",\"3D CANNABIS CENTER\", all_dsps$dba)\nall_dsps$dba <- gsub(\"3D DISPENSARY AND/OR 3D CANNABIS CENTER\",\"3D CANNABIS CENTER\", all_dsps$dba)\nall_dsps$dba <- gsub(\"21+\",\"\", all_dsps$dba)\nall_dsps$dba <- gsub(\" LLC\",\"\", all_dsps$dba)\n\n# only remove LLC if nothing else follows\nall_dsps$dba <- gsub(\"LLC(?!.)$\", \"\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"&\",\"AND\", all_dsps$dba)\nall_dsps$dba <- gsub(\",\",\"\", all_dsps$dba)\nall_dsps$dba <- gsub(\" INC\",\"\", all_dsps$dba)\nall_dsps$dba <- gsub(\"INC\",\"\", all_dsps$dba)\nall_dsps$dba <- gsub(\"'\",\"\", all_dsps$dba)\nall_dsps$dba <- gsub(\"?S\",\"S\", all_dsps$dba)\nall_dsps$dba <- gsub(\"-\",\"\", all_dsps$dba)\nall_dsps$dba <- gsub(\":\",\"\", all_dsps$dba)\nall_dsps$dba <- gsub(\"COMPANY\",\"\", all_dsps$dba)\nall_dsps$dba <- gsub(\" CO(?!.)$\", \"\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"CO(?!.)$\", \"\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"CENTERS\",\"CENTER\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LLP(?!.)$\", \"\", all_dsps$dba, perl = TRUE)\nall_dsps$dba <- gsub(\"B.GOOD\",\"BGOOD\", all_dsps$dba)\nall_dsps$dba <- gsub(\"B.?GOOD\",\"BGOOD\", all_dsps$dba)\nall_dsps$dba <- gsub(\"B GOOD\",\"BGOOD\", all_dsps$dba)\nall_dsps$dba <- gsub(\"DEN REC\",\"DENREC\", all_dsps$dba)\nall_dsps$dba <- gsub(\"111\",\"1:11\", all_dsps$dba)\nall_dsps$dba <- gsub(\"111\",\"1:11\", all_dsps$dba)\nall_dsps$dba <- gsub(\"ORGANICS\",\"ORGANIC\", all_dsps$dba)\nall_dsps$dba <- gsub(\"ALPENGLOW BOTANICALS\",\"ALPENGLOW\", all_dsps$dba)\nall_dsps$dba <- gsub(\"ALTITUDE ORGANIC CANNABIS\",\"ALTITUDE ORGANICS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"ALTITUDE ORGANIC MEDICINE\",\"ALTITUDE ORGANICS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"ANNIE?S DISPENSARY\",\"ANNIES DISPENSARY\", all_dsps$dba)\nall_dsps$dba <- gsub(\"ASCEND CANNABIS.\",\"ASCEND CANNABIS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BACK TO THE GARDEN HEALTH AND WELLNESS CENTER\",\"BACK TO THE GARDEN\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BACK TO THE GARDENS\",\"BACK TO THE GARDEN\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BEAN WELLNESS GROUP II\",\"BEAN WELLNESS GROUP\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BEST LORADO CANNABIS\",\"BEST LORADO MEDS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BEST LORADO MEDS ORG\",\"BEST LORADO MEDS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BEST LORADO MEDS.ORG\",\"BEST LORADO MEDS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BESTLORADOMEDS.ORG\",\"BEST LORADO MEDS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BESTLORADOMEDS.ORG\",\"BEST LORADO MEDS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BONFIRE CANNABIS MPANY\",\"BONFIRE CANNABIS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BOULDER MARIJUANA.\",\"BOULDER MARIJUANA\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BOULDER WELLNESS CANNABIS\",\"BOULDER WELLNESS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BRECKENRIDGE ORGANIX\",\"BRECKENRIDGE ORGANIC THERAPHY\", all_dsps$dba)\nall_dsps$dba <- gsub(\"BRECKENRIDGE CANNABIS CLUB\",\"BRECKENRIDGE ORGANIC THERAPHY\", all_dsps$dba)\nall_dsps$dba <- gsub(\"CLEARANCE CANNABIS.\",\"CLEARANCE CANNABIS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"CRESTED BUTTE WELLNESS CENTER\",\"CRESTED BUTTE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"CRESTED BUTTE ALTERNTIVE MEDICINE\",\"CRESTED BUTTE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"DO CRESTED BUTTE\",\"CRESTED BUTTE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"DOCTOR?S ORDERS\",\"DOCTORS ORDERS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"ENLIGHTENED CARE PLUS\",\"ENLIGHTENED CARE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"FIFTY 2 EIGHTY\",\"FIFTY2EIGHTY\", all_dsps$dba)\nall_dsps$dba <- gsub(\"GM ENTERPRISE.\",\"GM ENTERPRISE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"GREEN DREAM CANNABIS\",\"GREEN DREAM\", all_dsps$dba)\nall_dsps$dba <- gsub(\"GREEN DREAM HEALTH SERVICES\",\"GREEN DREAM\", all_dsps$dba)\nall_dsps$dba <- gsub(\"GREEN GRASS CENTRAL CITY\",\"GREEN GRASS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"GREEN FIELDS\",\"GREENFIELDS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"HEADQUARTERS CANNABIS\",\"HEADQUARTERS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"HEALING HOUSE DENVER\",\"HEALING HOUSE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"HEALING HOUSE LAKEWOOD\",\"HEALING HOUSE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"HELPING HANDS CANNABIS\",\"HELPINGHANDS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"HELPING HANDS HERBALS\",\"HELPINGHANDS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"HIGH COUNTRY HEALING 4\",\"HIGH COUNTRY HEALING\", all_dsps$dba)\nall_dsps$dba <- gsub(\"HIGH COUNTRY HEALING 5\",\"HIGH COUNTRY HEALING\", all_dsps$dba)\nall_dsps$dba <- gsub(\"HIGH COUNTRY HEALING 6\",\"HIGH COUNTRY HEALING\", all_dsps$dba)\nall_dsps$dba <- gsub(\"HIGH COUNTRY HEALING 8\",\"HIGH COUNTRY HEALING\", all_dsps$dba)\nall_dsps$dba <- gsub(\"IHC/SANTE\",\"IHC/SANTE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"IVITA WELLNESS\",\"IVITA\", all_dsps$dba)\nall_dsps$dba <- gsub(\"KIND LOVE / KL\",\"KIND LOVE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"KL\",\"KIND LOVE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"KIND LOVE EXPRESS\",\"KIND LOVE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"KIND MEDS\",\"KINDMEDS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LA NTES LNE BAR + DISPENSARY\",\"LANTES CLONE BAR AND DISPENSARY\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LANTES CLONE BAR + DISPENSARY\",\"LANTES CLONE BAR AND DISPENSARY\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LEAF ASPEN\",\"LEAF\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LEVELS IV.\",\"LEVELS IV\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LIGHTSHADE LABS\",\"LIGHTSHADE\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LIVWELL III\",\"LIVWELL\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LORADO HARVEST SUPPLY\",\"LORADO HARVEST\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LORADO HARVEST COMPANY\",\"LORADO HARVEST\", all_dsps$dba)\nall_dsps$dba <- gsub(\"LOTUS MEDICAL II\",\"LOTUS MEDICAL\", all_dsps$dba)\nall_dsps$dba <- gsub(\"MAGGIE?S FARM\",\"MAGGIES FARM\", all_dsps$dba)\nall_dsps$dba <- gsub(\"MAGNOLIA ROAD CANNABIS COMPANY\",\"MAGNOLIA ROAD\", all_dsps$dba)\nall_dsps$dba <- gsub(\"MAGNOLIA ROAD CANNABIS\",\"MAGNOLIA ROAD\", all_dsps$dba)\nall_dsps$dba <- gsub(\"MAGNOLIA ROAD CANNABIS\",\"MAGNOLIA ROAD\", all_dsps$dba)\n\n # removes all of the trailing names conventions\nall_dsps$dba <- gsub(\"MEDICINE MAN(?!.)$\",\"MEDICINE MAN\", all_dsps$dba, perl = TRUE )\nall_dsps$dba <- gsub(\"MMJ AMERICA(?!.$)\",\"MMJ AMERICA\", all_dsps$dba, perl = TRUE)\nall_dsps$dba <- gsub(\"MOUNTAIN MEDICINALS(?!.)$\",\"MOUNTAIN MEDICINALS\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"COMPASSIONATE CARE(?!.)$\",\"COMPASSIONATE CARE\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"MR. NICE GUYS\",\"MR NICE GUYS\", all_dsps$dba) #\nall_dsps$dba <- gsub(\"NATIVE ROOTS(?!.)$\",\"NATIVE ROOTS\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"NATURES HERBS(?!.)$\",\"NATURES HERBS\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"NATURES MEDICINE(?!.)$\",\"NATURES MEDICINE\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"NEW AMSTERDAM(?!.)$\",\"NEW AMSTERDAM\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"NORTHERN LIGHTS CANNABIS.\",\"NORTHERN LIGHTS CANNABIS\", all_dsps$dba) \nall_dsps$dba <- gsub(\"PATIENTS CHOICE(?!.)$\",\"PATIENTS CHOICE\", all_dsps$dba,  perl = TRUE) \nall_dsps$dba <- gsub(\"PEAK\",\"PEAK DISPENSARY\", all_dsps$dba) \nall_dsps$dba <- gsub(\"PINK HOUSE(?!.)$\",\"PINK HOUSE\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"PREFERRED ORGANIC(?!.)$\",\"PREFERRED ORGANIC\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"PRIMO\",\"PRIMO CANNABIS\", all_dsps$dba) \nall_dsps$dba <- gsub(\"PURE MARIJUANA DISPENSARY\",\"PURE DISPENSARY\", all_dsps$dba) #\nall_dsps$dba <- gsub(\"PURE MEDICAL DISPENSARY\",\"PURE DISPENSARY\", all_dsps$dba) \nall_dsps$dba <- gsub(\"PURE MEDICAL\",\"PURE DISPENSARY\", all_dsps$dba) \nall_dsps$dba <- gsub(\"RESERVE 1(?!.)$\",\"RESERVE 1\", all_dsps$dba, perl = TRUE) #\nall_dsps$dba <- gsub(\"RIVERROCK(?!.)$\",\"RIVERROCK\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"ROOTS RX\",\"ROOTSRX\", all_dsps$dba) \nall_dsps$dba <- gsub(\"SMOKEY?S\",\"SMOKEYS\", all_dsps$dba) \nall_dsps$dba <- gsub(\"SMOKED(?!.)$\",\"SMOKED\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"SMOKING GUN\",\"SMOKINGUN APOTHECARY\", all_dsps$dba) \nall_dsps$dba <- gsub(\"STAR BUDS\",\"STARBUDS\", all_dsps$dba) \nall_dsps$dba <- gsub(\"STEEL CITY MEDS(?!.)$\",\"STEEL CITY MEDS\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"STICKY BUDS(?!.)$\",\"STICKYBUDS\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"STICKY BUDS\",\"STICKYBUDS\", all_dsps$dba) \nall_dsps$dba <- gsub(\"TETRA HYDRO CENTER\",\"TETRAHYDROCENTER\", all_dsps$dba) \nall_dsps$dba <- gsub(\"THE CANARY?S SONG\",\"THE CANARYS SONG\", all_dsps$dba) \nall_dsps$dba <- gsub(\"THE CLINIC(?!.)$\",\"THE CLINIC\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"THE MEDICINE MAN\",\"MEDICINE MAN\", all_dsps$dba) \nall_dsps$dba <- gsub(\"THE SANCTUARY(?!.)$\",\"THE SANCTUARY\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"THE STONE\",\"THE STONE DISPENSARY\", all_dsps$dba) \nall_dsps$dba <- gsub(\"TRU CANNABIS(?!.)$\",\"TRU CANNABIS\", all_dsps$dba, perl = TRUE) \nall_dsps$dba <- gsub(\"TUMBLEWEEK DISPENSARY EDWARDS\",\"TUMBLEWEED DISPENSARY EDWARDS\", all_dsps$dba) \nall_dsps$dba <- gsub(\"UNITY RD. CANNABIS SHOP\",\"UNITY ROAD\", all_dsps$dba) \nall_dsps$dba <- gsub(\"WALKING RAVEN II\",\"WALKING RAVEN\", all_dsps$dba)\nall_dsps$dba <- gsub(\"WOLF PAC CANNABIS\",\"WOLFPAC CANNABIS\", all_dsps$dba)\nall_dsps$dba <- gsub(\"ALLGREENS\",\"CANNABIS MEDICAL TECHNOLOGY\", all_dsps$dba)\nall_dsps$dba <- gsub(\"3D CANNABIS CENTER AND 3D DISPENSARY\",\"3D CANNABIS CENTER\", all_dsps$dba)\n\n\nThis process takes a few minutes, so I exported the data for manual review.\n\n\nCode\nwrite.csv(all_dsps,\n          \"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dispensaries.csv\")\n\n\n\n\n\n\nidentify and label dispensaries by their type\nThere are several type of licenses recorded by the Colorado Department of Revenue. NIMBY focuses on recreational and medical dispensaries, so those are the businesses I have identified based on the license number as shown below.\n\n\nCode\ncleaned_dsps <- all_dsps\n\ncleaned_dsps <- cleaned_dsps %>%\n  mutate(type = if_else(startsWith(license_no, \"402R\"), \"retail\",\n                        if_else(startsWith(license_no, \"402-\"), \"medical\",\n                                \"other\")))\n\n#remove the testing facilities, growers and transporters\ndsps <-  cleaned_dsps %>% \n  filter(type == \"medical\" | type == \"retail\")\n\ndsps$dba <- ifelse(dsps$dba == \"NONE\", NA, dsps$dba) # change the None's to NAs\ndsps$zip<-  substr(dsps$zip, start = 1, stop = 5) # remove trailing numbers\n\n\n\n\n\n\nfind missing business names\nadapted from “Dplyr solution using slice and group”\nAlong with variations in spelling, some years the “doing business as” field was left blank. Assuming the license number is only assigned to the same business identified in another time period, I can use that information to create a master list of business names to match against.\n\n\nCode\n# select all business names and license numbers\ndsps_list <-dsps  %>% \n  select(dba, license_no) #\n\n# remove the missing fields, coming for those later\ndsps_list <- as.data.frame(na.omit(dsps_list)) # remove na\n\n# keep only the first instance (since their are multiple naming conventions \n# for each licensee)\ndsps_list <- dsps_list %>%\n  group_by(license_no) %>%\n  slice(1)\n\n# merge the business names by the license number \n# all.x = TRUE argument means include all rows from dsps \n # even if there is no matching row in dsps_list\ndsps_merge <- merge(dsps, dsps_list, by = \"license_no\", all.x= TRUE)\n\n#update the \"doing business as\" column, replace the N/As\ndsps_merge$dba <- coalesce(dsps_merge$dba.y, dsps_merge$dba.x)\n\n# if that still doesn't work, update the umatched licence numbers with the licensee name\ndsps_merge$dba <- coalesce(dsps_merge$dba, dsps_merge$licensee)\n\n# remove the duplicated columns\ndsps_merge <-  dsps_merge %>% \n  select(\n    license_no,\n    dba,\n    city,\n    zip,\n    type,\n    date,\n    year)\n\n\nHere is the new cleaned list of businesses with limited null fields!\n\n\nCode\nhead(dsps_merge)\n\n\n  license_no                         dba   city   zip    type       date year\n1  402-00001 CANNABIS MEDICAL TECHNOLOGY Denver 80204 medical 2020-08-01 2020\n2  402-00001 CANNABIS MEDICAL TECHNOLOGY Denver 80204 medical 2016-02-01 2016\n3  402-00001 CANNABIS MEDICAL TECHNOLOGY Denver 80204 medical 2020-12-01 2020\n4  402-00001 CANNABIS MEDICAL TECHNOLOGY Denver 80204 medical 2015-04-01 2015\n5  402-00001 CANNABIS MEDICAL TECHNOLOGY Denver 80204 medical 2013-11-01 2013\n6  402-00001 CANNABIS MEDICAL TECHNOLOGY Denver 80204 medical 2016-05-01 2016\n\n\n\n\n\n\nfind the missing zip codes\nThis same issue occurs with the zip code field, I apply the same technique used to find missing businesses.\n\n\nCode\ndsps_zips <-dsps_merge  %>% \n  select(zip, city, license_no) # add type for a distinct list\n\ndsps_zips <- as.data.frame(na.omit(dsps_zips)) # remove na\n\n# keep only the main/  first instance\ndsps_zips<- dsps_zips %>%\n  group_by(license_no) %>%\n  slice(1)\n\n#save this for creating per capita variables\nwrite.csv(dsps_zips,\n          \"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dsps_zips.csv\")  \n\n# xlook-up R style: overide the na's with the matches, same as a left_join\ndsps_merge_zips <- merge(dsps_merge, dsps_zips, by = \"license_no\", all.x= TRUE)\ndsps_merge_zips$zip <- coalesce(dsps_merge_zips$zip.x, dsps_merge_zips$zip.y)\n\n# remove the duplicated columns, and update the main data frame\nstorelist<-  dsps_merge_zips %>% \n  select(\n    license_no,\n    dba,\n    type,\n    city = city.x,\n    zip,\n    date,\n    year\n  )\n\n# export for manual review if needed\nwrite.csv(storelist,\n          \"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dispensaries.csv\")\n\n\n\n\n\n\nfind dispensaries that are both medical and recreational sellers\nadapted from “Join Data with dplyr in R: 6 Examples”\nThis is where my methodology differs drastically from the original paper. NIMBY matches the physical locations to determine which licensees are both medical and recreational (or retail).\n\nOur algorithm utilizes a customized cross-walk that identifies licenses assigned to the same address (e.g. matches 250 W. Colfax to 250 West Colfax) and identifies the co-location of medical and recreational based on the name of the business holding the licenses (since recreational licensees were granted only to the license holders of medical license).\n[@brinkman2017]\n\n\nMy approach to creating three buckets of dispensaries:\n\ndivide the data into two sets; “medical” and “retail” ,\ncross compare the lists, and identify where a business name appears in the “both” categories during the same time period\nremove the collocations from the retail and medical businesses\n\n\n\nCode\n# divide this into two new dataframes, one for medical, one for recreational\nmed_dsp <- filter(storelist, type == \"medical\")\nrec_dsp <- filter(storelist, type == \"retail\")\n\n# find the business that have the same name, city and date\n\n# with two different names, so this is my best estimate\nboth_dsp <- merge(med_dsp, rec_dsp, by = c(\"dba\", \"date\"))%>% \n  select(\n    dba,\n    \"city\" = `city.x`,\n    date,\n    \"year\" = `year.x`,\n    \"zip\" = `zip.x`)\nboth_dsp$type <-  \"both\" \n\n# remove duplicates\nboth_dsp <- both_dsp %>%  distinct(dba, date, type, .keep_all = TRUE)\n\n# removes the \"both\" businesses from the respective dataframes\nmed_only <- med_dsp %>%\n  anti_join(both_dsp, by = c(\"dba\", \"date\"))\nmed_only$type <-  \"med_only\" # label the type\n\nrec_only <- rec_dsp %>%\n  anti_join(both_dsp, by = c(\"dba\", \"date\"))\nrec_only$type <-  \"rec_only\" # label the type\n\n\n# combine the dataframes together (like if i were to copy and paste it at the bottom of an excel file)\nstorelist_cleaned <- bind_rows(med_only,both_dsp, rec_only )\nstorelist_cleaned <- storelist_cleaned %>%  distinct(dba, type, date, zip, .keep_all = TRUE)\n\nwrite.csv(storelist_cleaned,\n          \"dispensary_types_defined.csv\")"
  },
  {
    "objectID": "build_the_linear_model_step4.html",
    "href": "build_the_linear_model_step4.html",
    "title": "replicating nimby",
    "section": "",
    "text": "This code: imports the variables into a linear regression model\nImplements my variables into two linear models and outputs very sad p-values and confidence variables\n\nvariable checklist:\n\ncrimes per capita and YoY change\ndispensaries per capita and YoY change\nPoverty Rate\n% Black\n% Hispanic\nEmployment\n\n\n\nCode\nsource(\"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/linear_model/variables/crime and dispenaries per capita.R\")\n\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   1.0.1 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\nAttaching package: 'lubridate'\n\n\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n\n\n`summarise()` has grouped output by 'Geography'. You can override using the `.groups` argument.\nGetting data from the 2010-2014 5-year ACS\n\n\nCode\ncolnames(linear_variables) \n\n\n [1] \"GEOID\"            \"County\"           \"crime_per_cap\"    \"dps_per_cap\"     \n [5] \"crime_yoy_avg\"    \"dsp_yoy_avg\"      \"pct_poverty_rate\" \"pct_black\"       \n [9] \"pct_hispanic\"     \"employeed_pop\"   \n\n\nCode\nmodell <- lm(linear_variables$crime_yoy_avg ~ linear_variables$dsp_yoy_avg,  \n             data = linear_variables)\n\nsummary(modell)\n\n\n\nCall:\nlm(formula = linear_variables$crime_yoy_avg ~ linear_variables$dsp_yoy_avg, \n    data = linear_variables)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.42923 -0.12923 -0.02923  0.07077  1.07077 \n\nCoefficients:\n                             Estimate Std. Error t value Pr(>|t|)   \n(Intercept)                   0.12923    0.03807   3.394   0.0012 **\nlinear_variables$dsp_yoy_avg -0.07123    0.14326  -0.497   0.6208   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.29 on 62 degrees of freedom\nMultiple R-squared:  0.003972,  Adjusted R-squared:  -0.01209 \nF-statistic: 0.2472 on 1 and 62 DF,  p-value: 0.6208\n\n\nCode\nmodell\n\n\n\nCall:\nlm(formula = linear_variables$crime_yoy_avg ~ linear_variables$dsp_yoy_avg, \n    data = linear_variables)\n\nCoefficients:\n                 (Intercept)  linear_variables$dsp_yoy_avg  \n                     0.12923                      -0.07123  \n\n\nCode\n#  y = YOY crime at the county level\nmodel2 <- lm(linear_variables$crime_yoy_avg ~ linear_variables$dsp_yoy_avg +\n               linear_variables$pct_poverty_rate  +\n               linear_variables$pct_black  +\n               linear_variables$pct_hispanic  +\n               linear_variables$employeed_pop,\n                data = linear_variables)\n\nsummary(model2)\n\n\n\nCall:\nlm(formula = linear_variables$crime_yoy_avg ~ linear_variables$dsp_yoy_avg + \n    linear_variables$pct_poverty_rate + linear_variables$pct_black + \n    linear_variables$pct_hispanic + linear_variables$employeed_pop, \n    data = linear_variables)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.47400 -0.13238 -0.04318  0.08269  1.00885 \n\nCoefficients:\n                                    Estimate Std. Error t value Pr(>|t|)\n(Intercept)                        8.627e-02  1.145e-01   0.753    0.454\nlinear_variables$dsp_yoy_avg      -6.323e-02  1.543e-01  -0.410    0.683\nlinear_variables$pct_poverty_rate  6.074e-01  9.582e-01   0.634    0.529\nlinear_variables$pct_black        -2.071e-01  1.514e+00  -0.137    0.892\nlinear_variables$pct_hispanic     -1.692e-01  3.680e-01  -0.460    0.647\nlinear_variables$employeed_pop    -2.045e-07  4.720e-07  -0.433    0.666\n\nResidual standard error: 0.2976 on 58 degrees of freedom\nMultiple R-squared:  0.01903,   Adjusted R-squared:  -0.06554 \nF-statistic: 0.225 on 5 and 58 DF,  p-value: 0.9502\n\n\nCode\nmodel2\n\n\n\nCall:\nlm(formula = linear_variables$crime_yoy_avg ~ linear_variables$dsp_yoy_avg + \n    linear_variables$pct_poverty_rate + linear_variables$pct_black + \n    linear_variables$pct_hispanic + linear_variables$employeed_pop, \n    data = linear_variables)\n\nCoefficients:\n                      (Intercept)       linear_variables$dsp_yoy_avg  \n                        8.627e-02                         -6.323e-02  \nlinear_variables$pct_poverty_rate         linear_variables$pct_black  \n                        6.074e-01                         -2.071e-01  \n    linear_variables$pct_hispanic     linear_variables$employeed_pop  \n                       -1.692e-01                         -2.045e-07"
  },
  {
    "objectID": "calculate crime and dispensaries per capita_step3.html",
    "href": "calculate crime and dispensaries per capita_step3.html",
    "title": "replicating nimby",
    "section": "",
    "text": "This code: finds the crime and dispensary rates per 10,000 by county\n\nfinds the population three year average\ncalculates dispensaries per capita\nmaps the fbi historical crime data into a single data frame\ncalculates the county crime rates\nmatches the crime rates with the dispensaries per capita by geoid\nmaps the crime rates against the dispensaries growth\n\nload packages\n\n\n\nAttaching package: 'lubridate'\n\n\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0     ✔ purrr   1.0.1\n✔ tibble  3.2.1     ✔ dplyr   1.1.1\n✔ tidyr   1.2.1     ✔ stringr 1.5.0\n✔ readr   2.1.3     ✔ forcats 0.5.2\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ lubridate::as.difftime() masks base::as.difftime()\n✖ lubridate::date()        masks base::date()\n✖ dplyr::filter()          masks stats::filter()\n✖ lubridate::intersect()   masks base::intersect()\n✖ dplyr::lag()             masks stats::lag()\n✖ lubridate::setdiff()     masks base::setdiff()\n✖ lubridate::union()       masks base::union()\n\n\n\nload in my datasets\nselect the relevant fields\n\n\nCode\ndsps_avg <- read.csv(\"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dsps_yoy_qtiles.csv\") %>% \n  select(GEOID,\n  \"2013\" = X2013,\n  \"2014\" = X2014,\n  \"2015\" = X2015,\n  \"2016\" = X2016)\n\n\n\n\nfind the three year average count of dispensaries\n\n\nCode\ndsps_avg$dsps_average <-  rowMeans(dsps_avg[, c(\"2014\", \"2015\", \"2016\")], na.rm = TRUE)\ndsps_avg  <-  dsps_avg %>% mutate_at(\"dsps_average\", round, .2) # round\ndsps_avg <-  dsps_avg %>% select(GEOID,dsps_average)\n\n\n\n\nfind the local population rates for 2014. 2015, 2016\n\n\nCode\n#pull the population totals from the tidycensus\n  population_avg <- get_acs(\n    year = 2014,\n    geography = \"county\",\n    state = \"CO\",\n    variables = c(population_14 = \"B01001_001\",\n    output = \"wide\")) %>%\n    select(GEOID,\n    NAME,\n    \"pop14\" = estimate)\n\n\nGetting data from the 2010-2014 5-year ACS\n\n\nFetching data by table type (\"B/C\", \"S\", \"DP\") and combining the result.\n\n\nCode\n  population15 <- get_acs(\n    year = 2015,\n    geography = \"county\",\n    state = \"CO\",\n    variables = c(population_15 = \"B01001_001\",\n    output = \"wide\"\n    ))\n\n\nGetting data from the 2011-2015 5-year ACS\nFetching data by table type (\"B/C\", \"S\", \"DP\") and combining the result.\n\n\nCode\n  population16 <- get_acs(\n    year = 2016,\n    geography = \"county\",\n    state = \"CO\",\n    variables = c(population_15 = \"B01001_001\",\n    output = \"wide\"\n    ))\n\n\nGetting data from the 2012-2016 5-year ACS\nFetching data by table type (\"B/C\", \"S\", \"DP\") and combining the result.\n\n\n\n\njoin the population fields to the main dataframe\n\n\nCode\n# add the population estimates to the main doc.  \npopulation_avg$pop15 <- population15$estimate\npopulation_avg$pop16 <- population16$estimate\n\n# find the average population over the time period\npopulation_avg$pop_avg <-  rowMeans(population_avg[, c(\"pop14\", \"pop15\", \"pop16\")], na.rm = TRUE)\npopulation_avg  <-  population_avg  %>% mutate_at(\"pop_avg\", round) # round\n\n#use this data to calculate crime rates\nwrite.csv(population_avg, (\"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/crime/populations_avg.csv\")) \n\n\npopulation_avg <- population_avg %>%\nselect(1,2,6) #geo id, name and average\n\n\n\n\nmatch the geoids and calculate the per capital dispensary rate\n\n\nCode\n#match the geoids between the two dataframes\npopulation_avg$GEOID <-  as.integer(population_avg$GEOID)\npopulation_avg$NAME<- gsub(\" County, Colorado\", \"\", population_avg$NAME) # format the name to fit the crime\ndsps_per_capita <- left_join(population_avg, dsps_avg, by = \"GEOID\") %>% \nmutate_at(vars(4), replace_na, replace = 0) # remove NAs\n\n# calculate the dispensary per 10,000 population rate\ndsps_per_capita$dps_per_cap <- (dsps_per_capita$dsps_average / dsps_per_capita$pop_avg) * 10000\ndsps_per_capita  <-  dsps_per_capita %>% mutate_at(vars(starts_with(\"dps\")), funs(round(., 1))) # round\n\n\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n\n\n\n\npull in the fbi crime data same as the dispensary\n\n\n\n\n\nfilter to get 2016 data, and pivot, summarize by year and geography\ncalcuate YOY average\n\n\nCode\nall_co_crime  <- all_co_crime %>% \n   filter(year < 2017) %>% \n   group_by(Geography, year) %>% \n   summarise(Total_Offenses = sum(`Total\\nOffenses`)) %>% \n   pivot_wider(names_from = \"year\", values_from = \"Total_Offenses\") \n\n\n`summarise()` has grouped output by 'Geography'. You can override using the\n`.groups` argument.\n\n\nCode\nsource(\"~/gvsu/winter 23/CIS 635/NIMBY/formatted code/yoy_function.R\")\nall_co_crime  <-  yoy_avg_function(all_co_crime) %>% \n  rename(crime_yoy_avg = dsp_yoy_avg)\n\n\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n\n\nCode\nall_co_crime $crime_average <- rowMeans(all_co_crime [, c(\"2014\", \"2015\", \"2016\")], na.rm = TRUE) \nall_co_crime  <-  all_co_crime  %>% select(1,9,10)\n\n\n\n\ncalculate the crimes per capita\njoin to the population totals\n\n\nCode\ncrime_per_capita <-  left_join(population_avg, all_co_crime, by = c(\"NAME\" = \"Geography\"))\n\ncrime_per_capita$crime_per_cap <- (crime_per_capita$crime_average / crime_per_capita$pop_avg ) * 10000\ncrime_per_capita <-  crime_per_capita %>% mutate_at(vars(starts_with(\"crime\")), funs(round(., 1)))  # round\n\n\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n\n\n\n\ntime to join the per capitas together\n\n\nCode\n# connect the variables, pulling some in from the density file\ndsps_yoy_qtiles <-  read.csv(\"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dsps_yoy_qtiles.csv\")\n\n\n\nlinear_variables <-  left_join(crime_per_capita, dsps_per_capita, by = \"GEOID\")\nlinear_variables <-  left_join(linear_variables, dsps_yoy_qtiles, by = \"GEOID\")\n\ncolnames(linear_variables)\n\n\n [1] \"GEOID\"            \"NAME.x\"           \"pop_avg.x\"        \"crime_yoy_avg\"   \n [5] \"crime_average\"    \"crime_per_cap\"    \"NAME.y\"           \"pop_avg.y\"       \n [9] \"dsps_average\"     \"dps_per_cap\"      \"X\"                \"pop_2014\"        \n[13] \"pov_pop_14\"       \"pov_base\"         \"black_pop\"        \"hispanic_pop\"    \n[17] \"employeed_pop\"    \"X2013\"            \"X2014\"            \"X2015\"           \n[21] \"X2016\"            \"pct_poverty_rate\" \"pct_black\"        \"pct_hispanic\"    \n[25] \"qrt_pov\"          \"qrt_black\"        \"qrt_hispanic\"     \"qrt_employment\"  \n[29] \"yoy_2014\"         \"yoy_2015\"         \"yoy_2016\"         \"dsp_yoy_avg\"     \n\n\nCode\nlinear_variables <-  linear_variables %>%\n  select(\n    GEOID,\n    \"County\" =`NAME.x`,\n    crime_per_cap,\n    dps_per_cap,\n    crime_yoy_avg,\n    dsp_yoy_avg,\n    dsps_average,\n    pct_poverty_rate,\n    pct_black,\n    pct_hispanic,\n    employeed_pop)\n\n\n# update the NAs to reflect the 0 crimes and the 0 dispensary locations\nlinear_variables <- linear_variables %>%\n  mutate(dsp_yoy_avg = round(dsp_yoy_avg, 1)) %>%\n  mutate(dsp_yoy_avg = if_else(is.na(dsp_yoy_avg), 0, dsp_yoy_avg)) %>%\n  mutate(dsp_yoy_avg = if_else(dsp_yoy_avg == Inf, 0, dsp_yoy_avg)) %>%\n  mutate(crime_yoy_avg = if_else(is.na(crime_yoy_avg), 0, crime_yoy_avg)) %>%\n  mutate(crime_yoy_avg = if_else(crime_yoy_avg == Inf, 0, crime_yoy_avg))\n\n\n\nwrite.csv(linear_variables, \"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/linear_model/variables/linear_variable.csv\")\n\n\n\n\nmaking a map\nadapted from “Creating Maps in R”\n\n\nCode\nlibrary(ggplot2)\nlibrary(maps)\n\n\n\nAttaching package: 'maps'\n\n\nThe following object is masked from 'package:purrr':\n\n    map\n\n\nCode\nlibrary(dplyr)\nlibrary(cowplot)\n\n\n\nAttaching package: 'cowplot'\n\n\nThe following object is masked from 'package:lubridate':\n\n    stamp\n\n\nCode\n# Load the county boundaries data for Colorado\ncounties <- map_data(\"county\", \"colorado\")\ncounties <- rename(counties, County = subregion)\n\n# Convert 'County' to lowercase for merging with 'linear_variables'\nlinear_variables$County <- tolower(linear_variables$County)\nmy_map_data <- left_join(counties, linear_variables, by = \"County\")\n\n# Remove duplicate counties from the merged data\nmy_map_dsps_data <- distinct(my_map_data, County, .keep_all = TRUE)\n\n# find the centroids by averaging all of duplicat\ncentroid_coords <- my_map_dsps_data %>%\n  group_by(group) %>%\n  summarize(\n    X = mean(long),\n    Y = mean(lat),\n    `Dispensary Count` = mean(dsps_average))\n\n\n\n# Create the heat map\nmy_map <- ggplot() +\n  # heat map\n  geom_polygon(data = my_map_data , \n               aes(x = long, y = lat, group = group, fill = crime_per_cap)) +\n labs(title = \"Crime Rate and Dispensary Count by County in Colorado\",\n      subtitle = \"Three Year Average 2014, 2015, 2016\",\n       fill = \"Crime Rate\") +\n  scale_fill_gradient(low = \"#F8E9E8\", high = \"#C9463F\") +\n\n  # geo bubble charts\n  geom_point(data = centroid_coords, aes(x = X, y = Y, size =  `Dispensary Count`),\n             color = \"#AD9BCB\", alpha = 0.8) + \n  theme_map()\n\nmy_map"
  },
  {
    "objectID": "Final Report_draft.html#introduction",
    "href": "Final Report_draft.html#introduction",
    "title": "replicating nimby",
    "section": "- Introduction",
    "text": "- Introduction\nSomewhere in my mother’s basement, is my prized 1995 tie-dyed DARE tee-shirt, a paradoxical relic of elementary classroom hours spent discussing the dangers of peer-led drug use.  Those fears were not unwarranted, the CDC (Center for Disease Control) reports that 136 Americans die daily from opioids and illicitly manufactured fentanyl1, for me - a friend or three. In my experience, most drug prevention programs portray cannabis as the catalyst to the life doomed by addiction.\nWhen recreational cannabis use became legal in Michigan, the culture shift was palpable. In an ironic twist of fate, the taboo habits of those once deemed as social deviants are now capitalized and funding K-12 education2. I am fascinated by this turn of events, and I am curious if there are predictors from more tenured “green” states that reveal unintended ill-consequences.\nIn my data mining project, I explore the relationship between the presence of cannabis dispensaries and neighborhood crime rates. By replicating the methodology of Brinkman and Mok-Lamme’s 2019 study, “Not in my backyard? Not so fast. The effect of marijuana legalization on neighborhood crime” (NIMBY), I aim to contribute a nuanced perspective on this budding industry and how it shapes public safety and city planning.\nMy approach involved immersing myself in the wild world of crime and cannabis statistics in Colorado. Using the data sources outlined in NIMBY, I built the variables defined in NIMBY’s linear regression model, described in more detail in the methods section.\nIn line with the results in NIMBY, my findings indicate that there is no statistically significant relationship between an increased presence of cannabis dispensaries and crime."
  },
  {
    "objectID": "Final Report_draft.html#related-works",
    "href": "Final Report_draft.html#related-works",
    "title": "replicating nimby",
    "section": "- Related Works",
    "text": "- Related Works\nA related and noteworthy body of work is the 2021 meta-analysis conducted by D. Mark Anderson and Daniel I. Rees’ paper “The Public Health Effects of Legalizing Marijuana.” The appendix presents an extensive comparison of 70 studies related to the impact of marijuana legalization on public health outcomes by empirical strategy, and study results. This paper served as an excellent resource to understand the myriad of ways in which this topic is being studied, including the study I will replicate. The authors ultimately conclude that while the existing body of research benefits from a wealth of state-level data, the outcomes remain inconclusive. Further research along with careful policy design is needed to mitigate the negative impact of legalization on crime rates and other outcomes.\nIn contrast, the 2019 paper “Marijuana Dispensaries and Neighborhood Crime and Disorder in Denver, Colorado” by Lorrine A. Hughes, Lonnie M. Schaible, and Katherine Jimmerson offers contradictory findings. Utilizing a Bayesian Poisson regression model, the authors discovered a statistically significant correlation between the presence of dispensaries and increased rates of neighborhood crime—except for murder and auto theft. This study highlights the complexities of the issue and the necessity for a more nuanced understanding of the interplay between cannabis dispensaries and crime rates."
  },
  {
    "objectID": "Final Report_draft.html#methods",
    "href": "Final Report_draft.html#methods",
    "title": "replicating nimby",
    "section": "- Methods",
    "text": "- Methods\nWhile all of the data referenced in NIMBY is publicly available, I found it necessary to deviate from the original’s papers methodology due to data quality issues and time constraints.\nMy diagram below illustrates the utilization of R code to construct a data pipeline for the linear model and its associated variables.\nIn the interest of interpretability, I divided my work into four distinct segments, each highlighted in the navigation bar of this site. I hope this structured breakdown allows readers to navigate through my process efficiently, providing transparent insight into my methods employed and limitations faced throughout this project.\n\nIn summation, the data mining pipeline consisted of several stages, each color coded above.\n\nDispensary license records were cleaned and preprocessed, removing irrelevant columns, standardizing the format, and aggregating the data by county and year. | code\nLeveraging the power of the TidyCensus package, I extracted population data for the target variables from the American Community Survey (ACS) census database. | code\nI wove the datasets together using county-level identifiers (GEOID), allowing for the computation of per capita values for dispensaries and crime rates and year-over-year fluctuations. | code\nFinally, I introduced the new variables into a linear model regression model. | code\n\nThe goal is to estimate the causal effect of changes in dispensary density on changes in crime rates, while accounting for potential biases and confounding factors using the linear regression model above.\n\n\n\n\n\n\n\nVariable\nDefined\n\n\n\n\nΔcrime\nyear-over-year changes in crime rates\n\n\nΔdisp\nyear-over-year changes in dispensary rates\n\n\nj\nneighborhood\n\n\nt\ntime\n\n\n𝛽0\n(intercept) baseline level of year-over-year changes in crime rates\n\n\n𝛽1\nexpected change in year-over-year crime rates associated with a one-unit increase\n\n\n𝛽2\nvector of estimated coefficients on the control variables (demographic characteristics, economic conditions)\n\n\nx\na vector of control variables (demographic characteristics, economic conditions)\n\n\nΔ𝛿\ntime fixed effects\n\n\n⋲\nerror term"
  },
  {
    "objectID": "Final Report_draft.html#results-and-discussion",
    "href": "Final Report_draft.html#results-and-discussion",
    "title": "replicating nimby",
    "section": "- Results and Discussion",
    "text": "- Results and Discussion\n\nComparing Dispensary Counts\n\n\nComparing Control Variables\n\nhow to read: NIMBY’s Table1 Panel B, shows the quartiles counties (lowest to highest) by the four variables. The percentages of the table represent the three-year average of year-over-year growth in dispensary businesses.\ninterpretation: the average county in Colorado saw a 11.9% increase in the number of dispensaries between 2014-2017. Counties that fall within the 4th quartile (highest) for poverty rates saw the largest increase (22.1%) average growth in the number of dispensaries, followed by the 4th quartile for Hispanic populations, and the 1st quartile (lowest) employed populations.\n\n\n\ncomparison: now let’s look at my results, my calculations led me to a 11.5% three-year average growth in dispensaries, which is very close NIMBY’s result. However, when I compare the individual demographics there is a lot of variance between the two results. The lowest quartile for employed populations revealed the most growth in dispensaries (+50.8%), followed by the 2nd quartile for black populations (27.0%).\n\n\nComparing the Dependent and Independent variables:\n\nWhat’s interesting here is XYZ"
  },
  {
    "objectID": "Final Report_draft.html#conclusion",
    "href": "Final Report_draft.html#conclusion",
    "title": "replicating nimby",
    "section": "- Conclusion",
    "text": "- Conclusion\nthe zen art of naivety"
  },
  {
    "objectID": "Final Report_draft.html#data-and-software",
    "href": "Final Report_draft.html#data-and-software",
    "title": "replicating nimby",
    "section": "- Data and Software",
    "text": "- Data and Software\n\nData Sources:\n\nColorado Department of Revenue: Medical and Retail Marijuana Licencees\nCity and County of Denver Surveyor’s Office: Denver Geographic Boundaries\nFBI Uniform Crime Reporting Program: Colorado\n2014 American Community Survey: Colorado Population, Race, Ethnicity, and Poverty Rates\n\n\n\nSoftware:\n\nRstudio\n\nPackages:\n\nfs (Hester, Wickham, and Csárdi 2021)\nlubridate (Grolemund and Wickham 2011)\nopenxlsx (Schauberger and Walker 2023)\nreadx (Wickham and Bryan 2023)\nsf (Pebesma 2018)\ntidycensus (Walker and Herman 2023)\ntidygeocoder (Cambon et al. 2021)\ntidyverse (Wickham et al. 2019)\ntigris (Walker 2023)"
  },
  {
    "objectID": "Final Report_draft.html#references",
    "href": "Final Report_draft.html#references",
    "title": "Replicating NIMBY",
    "section": "- References",
    "text": "- References\nBrinkman, J., & Mok-Lamme, D. (2019). Not in my backyard? Not so fast. The effect of marijuana legalization on neighborhood crime. Regional Science and Urban Economics, 78. https://doi-org.ezproxy.gvsu.edu/10.1016/j.regsciurbeco.2019.103460\nAnderson, D. M., & Rees, D. I. (2023). The Public Health Effects of Legalizing Marijuana. Journal of Economic Literature, 61(1), 86–143. https://doi-org.ezproxy.gvsu.edu/10.1257/jel.20211635\nHughes, Lorine A., Lonnie M. Schaible, and Katherine Jimmerson. “Marijuana Dispensaries and Neighborhood Crime and Disorder in Denver, Colorado.” Justice Quarterly, vol. 37, no. 3, 2020, pp. 461-485, doi: 10.1080/07418825.2019.1567807."
  },
  {
    "objectID": "Label the Dispensaries with GeoCodes_step2.html",
    "href": "Label the Dispensaries with GeoCodes_step2.html",
    "title": "replicating nimby",
    "section": "",
    "text": "This code: creates a table of dispensary density by socioeconomic factors\n\nmatches zip codes to census geocodes\nconnects to census API\nretrieves demographic population data\ncalculates poverty, race, and employment rates\nmatches the statistics above with year-over-year changes in dispensaries\ngenerates an overly formatted table showing dispensary YOY growth by socioeconomic quartiles\n\n\nThis section of my methodology was the most exciting for me, yet it was also where I recognized the need to adapt my approach. My first limitation was the challenge of matching dispensary locations to their corresponding census tracts. To achieve this, I would need to obtain each location’s physical address, which was not provided by Colorado.Gov’s dispensary archive. While this information can be accessed for a price through vendors or tediously scraping the web, for the sake of time and sanity, proceeding with county-level data was my best option for completing this project.\nNonetheless, the TIGRIS package’s ability to create maps at the census tract level remains a potent instrument in an analyst’s arsenal. Although the tract level identifiers are not utilized beyond this point, I have included it as a reference for future projects and as part of my Replicating NIMBY journey. Due to the differences in methodology, my figures do not align flawlessly; however, examining the overall trends for congruence remains a worthwhile endeavor.\n\nload packages\n\n\n\nAttaching package: 'lubridate'\n\n\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n\n\nLinking to GEOS 3.9.3, GDAL 3.5.2, PROJ 8.2.1; sf_use_s2() is TRUE\n\n\nTo enable caching of data, set `options(tigris_use_cache = TRUE)`\nin your R script or .Rprofile.\n\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0     ✔ purrr   1.0.1\n✔ tibble  3.2.1     ✔ dplyr   1.1.1\n✔ tidyr   1.2.1     ✔ stringr 1.5.0\n✔ readr   2.1.3     ✔ forcats 0.5.2\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ lubridate::as.difftime() masks base::as.difftime()\n✖ lubridate::date()        masks base::date()\n✖ dplyr::filter()          masks stats::filter()\n✖ lubridate::intersect()   masks base::intersect()\n✖ dplyr::lag()             masks stats::lag()\n✖ lubridate::setdiff()     masks base::setdiff()\n✖ lubridate::union()       masks base::union()\n\n\n\n\nimport data\n\n\nCode\n# list of dispensaries\ndsps <-  as.data.frame(read.csv(\"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dispensary_types_defined.csv\"))\n\n# list of all zip codes with at lease one dispensary\ndsps_zips <-  as.data.frame(read.csv(\"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dsps_zips.csv\"))\n\n#county geocodes scraped from Wikipedia\ncounty_codes <- (read.csv(\"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/density tables/county_FIPS_codes.csv\"))\n\n\n\n\nspatial join between dispensary locations and geocodes\nAt this stage, the zip codes are my main geographical identifier for my dispensary data frame. In an attempt to find the tract level data, I tapped into the Tigris package.   adapted from “tigris”\n\n\n\n\n\n\n\nmatch the files to the county codes with join\n\n\nCode\n# time to add the spacial data to my dispensary list!\ndsps$zip <-  as.character(dsps$zip) # convert_back to characters\ndsps<- left_join(dsps, dsps_geos, by = \"zip\")\ndsps$county_code <-  as.integer(dsps$county_code) # using an intgers to join other datasets\n\n# a lovely document with dispensary tracts and county codes\ndsps<- left_join(dsps, county_codes, by = \"county_code\")\n\n# saving for later in case I can use the tract level data\nwrite.csv(dsps, \"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dispenaries_tracts.csv\")\n\n\n \n\n\ncount the dispensaries with summarize\n\n\nCode\ndsps_summed <-  dsps %>% \n  filter(month(date) == 12) %>% \n  filter(year < 2017) %>% \n  select(dba, county_code, \"GEOID\" =GEOID.y, year) %>% \n  group_by(year, GEOID) %>% \n  summarise(num_licenses = n()) %>% \n  pivot_wider(names_from = year, values_from = num_licenses, values_fill = 0)\n\n\n`summarise()` has grouped output by 'year'. You can override using the\n`.groups` argument.\n\n\nCode\nwrite.csv(dsps_summed, \"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dispensary_counts_county_year.csv\")\n\n\n\n\nretrieve census population data with Tidy Census\nthe paper looks at the poverty rate, percent black, percent Hispanic, and the employment rate demographic data comes from the U.S. Census 2014 American Community Survey 5-year sample, and employment data comes from the U.S. Census 2013 Origin-Destination Employment Statistics\nI’ve already established an API census_api_key(“[API removed for privacy]”, install = TRUE)\nSocialExplore.com is a helpful website for definitions:\n\n\nCode\n#I've already established an API census_api_key\n#(\"\\[API removed for privacy\\]\", install= TRUE)\n\ndemo_factors <- get_acs(\n  year = 2014,\n  geography = \"county\",\n  state = \"CO\",\n  variables = c(population_14 = \"B01001_001\",\n                pov_base_14 = \"B17001_001\", # Universe: Population for whom poverty status Is determined (base of % poverty)\n                pov_pop_14 = \"B17001_002\", # Income in the Past 12 Months Below Poverty Level\n                employeed = \"B23025_002\", # employed in labor for (16+)\n                black = \"B03002_004\",\n                hispanic = \"B03002_012\"),\n\n  output = \"wide\"\n) \n\n\nGetting data from the 2010-2014 5-year ACS\n\n\nCode\n# i look forward to the day when the racial makeup of a zip code isn't an assumed identifier for poverty\ncolnames(demo_factors)\n\n\n [1] \"GEOID\"          \"NAME\"           \"population_14E\" \"population_14M\"\n [5] \"pov_base_14E\"   \"pov_base_14M\"   \"pov_pop_14E\"    \"pov_pop_14M\"   \n [9] \"employeedE\"     \"employeedM\"     \"blackE\"         \"blackM\"        \n[13] \"hispanicE\"      \"hispanicM\"     \n\n\n\n\n\n\nmatch the change in dispensary density with demographics\nHere I join two datasets using “GEOID”, aggregate the annual population and demographic factors by geographic ID. Next, I created new variables representing the total population and economic indicators for each geographic ID. The resulting dataset has one row per unique geographic ID.\n\n\nCode\n# switching from merging to left joins since it's easier to read\ndemo_factors$GEOID <-  as.integer(demo_factors$GEOID)\ndsps_summed$GEOID <-  as.integer(dsps_summed$GEOID)\n\ndsps_yoy_demos <- left_join(demo_factors, dsps_summed, by = \"GEOID\")\ncolnames(dsps_yoy_demos)\n\n\n [1] \"GEOID\"          \"NAME\"           \"population_14E\" \"population_14M\"\n [5] \"pov_base_14E\"   \"pov_base_14M\"   \"pov_pop_14E\"    \"pov_pop_14M\"   \n [9] \"employeedE\"     \"employeedM\"     \"blackE\"         \"blackM\"        \n[13] \"hispanicE\"      \"hispanicM\"      \"2013\"           \"2014\"          \n[17] \"2015\"           \"2016\"          \n\n\nCode\ndsps_yoy_demos <- dsps_yoy_demos %>%\n  mutate_at(vars(15:18), replace_na, replace = 0) %>%\n  group_by(GEOID) %>% # add the total ins\n  summarize(\n    pop_2014 = sum(population_14E),\n    pov_pop_14 = sum(pov_pop_14E),\n    pov_base = sum(pov_base_14E),\n    black_pop = sum(blackE),\n    hispanic_pop = sum(hispanicE),\n    employeed_pop = sum(employeedE),\n    `2013` = sum(`2013`),\n    `2014` = sum(`2014`),\n    `2015` = sum(`2015`),\n    `2016` = sum(`2016`)\n  )\n\n\n \n\n\nyear-over-year function\nOne of former professors told me, if you have do write something three times then it’s time to write a function! The year over year variance is another crucial aspect of NIMBY’s model. This function will be applied to several variables\n\n\nCode\n# make a function to calculate the year over year changes\nyoy_avg_function <- function(df) {\n  # calculate  growth rates\n  df$yoy_2014 <- ((df$`2014` - df$`2013`) / df$`2013`) \n  df$yoy_2015 <- ((df$`2015` - df$`2014`) / df$`2014`) \n  df$yoy_2016 <- ((df$`2016` - df$`2015`) / df$`2015`) \n  \n  # average growth rate and round to 3 decimal places\n  df$dsp_yoy_avg <- rowMeans(df[, c(\"yoy_2014\", \"yoy_2015\", \"yoy_2016\")], na.rm = TRUE)\n  df <- df %>% mutate_at(vars(starts_with(\"dsp\")), funs(round(., 3))) # round\n  \n  return(df)\n}\n\n\n\n\n\n\ncalculate the year-over-year change average in dispensaries for the state of Colorado\n\n\nCode\ncolorado_yoy_average <-  dsps_yoy_demos %>% \n  summarize(\n    `2013` = sum(`2013`),\n    `2014` = sum(`2014`),\n    `2015` = sum(`2015`),\n    `2016` = sum(`2016`)\n  )\n\ncolorado_yoy_average <-  yoy_avg_function(colorado_yoy_average) %>% \n  select(\"Colorado Average\" = dsp_yoy_avg)\n\n\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n\n\n\n\nfind the race, poverty and employment rates at the county level\n\n\nCode\n# make the rates\n# create the percentages:\ndsps_yoy_demos  <- dsps_yoy_demos %>% \n  #create percentages  \n  mutate(pct_poverty_rate = (pov_pop_14/pov_base),\n         pct_black = (black_pop/ pop_2014),\n         pct_hispanic = (hispanic_pop/ pop_2014)) %>% \n  #round\n  mutate_at(vars(starts_with(\"pct\")), funs(round(., 3)))\n\n\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n\n\n\n\ncreate quartiles to recreate table1\n\n\n\ntable1 from the original paper is my second reference at cross comparing my results against NIMBY’s\n\n\nUsing the ntile function, I classify the dispensary year-over-year changes by counties quartiles of the various variables\n\n\nCode\ndsps_yoy_demos <- dsps_yoy_demos %>% \n  mutate(qrt_pov = ntile(pct_poverty_rate,4)) %>% \n  mutate(qrt_black = ntile(pct_black,4)) %>%\n  mutate(qrt_hispanic = ntile(pct_hispanic,4)) %>% \n  mutate(qrt_employment = ntile(employeed_pop,4))\n\n# calculate the YOY average\ndsps_yoy_qtiles <- yoy_avg_function(dsps_yoy_demos) \n\n\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n\n\nCode\n# save the data for the crime per capita calculations\nwrite.csv(dsps_yoy_qtiles, \"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dsps_yoy_qtiles.csv\")\n\n\n\n\ntransform the data into a tabluar format to be presented in a simple summarized table\n\n\nCode\n# poverty quartiles by dispensary density\npoverty_qts <- dsps_yoy_qtiles %>% \n  select(\n    qrt_pov,\n    `2013`,\n    `2014`,\n    `2015`,\n    `2016`\n      ) %>% \n  group_by(qrt_pov) %>% # add the total ins\n  summarize(\n    `2013` = sum(`2013`),\n    `2014` = sum(`2014`),\n    `2015` = sum(`2015`),\n    `2016` = sum(`2016`)\n  ) %>% \n  yoy_avg_function  %>% \n  select(1,9)\n  \n\n# I checked and my total match across quartiles, and look similar to the area graph data\n# black population quartiles by dispensary density\nblack_qts <- dsps_yoy_qtiles %>% \n  select(\n    qrt_black,\n    `2013`,\n    `2014`,\n    `2015`,\n    `2016`\n  ) %>% \n  group_by(qrt_black) %>% # add the total ins\n  summarize(\n    `2013` = sum(`2013`),\n    `2014` = sum(`2014`),\n    `2015` = sum(`2015`),\n    `2016` = sum(`2016`)\n  ) %>% \n  yoy_avg_function  %>% \n  select(1,9)\n\n# Hispanic quartiles by dispensary density\nhispanic_qts <- dsps_yoy_qtiles %>% \n  select(\n    qrt_hispanic,\n    `2013`,\n    `2014`,\n    `2015`,\n    `2016`\n  ) %>% \n  group_by(qrt_hispanic) %>% # add the total ins\n  summarize(\n    `2013` = sum(`2013`),\n    `2014` = sum(`2014`),\n    `2015` = sum(`2015`),\n    `2016` = sum(`2016`)\n  ) %>% \n  yoy_avg_function  %>% \n  select(1,9)\n\n# employment quartiles by dispensary density\nemployment_qts <- dsps_yoy_qtiles %>% \n  select(\n    qrt_employment,\n    `2013`,\n    `2014`,\n    `2015`,\n    `2016`\n    ) %>% \n    group_by(qrt_employment) %>% # add the total ins\n      summarize(\n        `2013` = sum(`2013`),\n        `2014` = sum(`2014`),\n        `2015` = sum(`2015`),\n        `2016` = sum(`2016`)\n      ) %>% \n  yoy_avg_function  %>% \n  select(1,9)\n\n\n\n\ncreate a table of all my variables:\n\n\nCode\n# put everything together \ndensity_table1 <- poverty_qts %>%\n  left_join(black_qts, by = c(\"qrt_pov\" = \"qrt_black\")) %>%\n  left_join(hispanic_qts, by = c(\"qrt_pov\" = \"qrt_hispanic\")) %>%\n  left_join(employment_qts, by = c(\"qrt_pov\" = \"qrt_employment\"))\n\n\n# rename the columns\ncolnames(density_table1) <- c(\"Quartile\", \"Poverty Rate\", \"Pct. Black\", \"Pct. Hispanic\", \"Employment\", \"Colorado Average\")\ncombined_table <- bind_rows(density_table1 , colorado_yoy_average)\n\n\n\n\ncreate a formated table for the results section\nformat the table for a side by side comparison\nadapted from “Making high-quality tables in R with the gt package”\n\n\nCode\ntable2 <- combined_table %>% \n gt() %>%  # table function\n  sub_missing(\n    columns = everything(), # remove the NAs from my Colorado Stat, appears blank\n    missing_text = \"\"\n  ) %>% \n  \n  \n  tab_header(\n    title = \"average change in dispensary density by local characteristics\",\n    subtitle = \"replicated for the state of Colorado\"\n  ) %>%\n  \n  # column headers\n  tab_style(\n    style = cell_text(weight = \"bold\", align = \"center\"),\n    locations = cells_column_labels(everything())\n  ) %>% \n \n  # cells\n   tab_style(\n    style = cell_text(align = \"center\"),\n    locations = cells_body(columns = everything())\n  ) %>% \n \n  # cells \n  tab_style(\n    style = cell_borders(sides = \"all\", color = \"transparent\", weight = px(0)),\n    locations = cells_body(columns = `Colorado Average`)\n  ) %>%\n  \n  # cells\n  tab_style(\n    style = cell_fill(color = \"#ABC7A9\", alpha = 0.2),\n    locations = cells_body(columns = vars(`Colorado Average`))\n  ) %>%\n \n  # last column\n   tab_style(\n    style = cell_borders(sides = \"left\", color = \"black\", weight = px(1)),\n    locations = cells_body(columns = `Colorado Average`)\n  ) %>%\n  \n  # last column\n  tab_style(\n    style = cell_fill(color = \"#f2f2f2\"),\n    locations = cells_body(rows = seq(1, nrow(combined_table), by = 2), columns = 1:(ncol(combined_table) - 1))\n  ) %>%\n  \n  tab_style(\n    style = cell_text(size = \"18px\", style = \"italic\"),\n    locations = cells_title(groups = \"title\")\n  ) %>%\n  \n  # spending too much time on the headers :-) \n  tab_options(\n    column_labels.border.top.color = \"white\",\n    column_labels.border.top.width = px(3),\n    column_labels.border.bottom.color = \"black\",\n    table_body.border.bottom.color = \"black\",\n    table.width = pct(100),\n    data_row.padding = px(10),\n    column_labels.background.color = \"#73A16F\"\n  ) %>%\n  \n  tab_options(\n    data_row.padding = px(12)\n  ) %>%\n  cols_width(\n    starts_with(\"Color\") ~ px(80),\n    everything() ~ px(120)\n  )\n\n\nWarning: Since gt v0.3.0, `columns = vars(...)` has been deprecated.\n• Please use `columns = c(...)` instead.\n\n\nCode\ntable2\n\n\n\n\n\n\n  \n    \n    \n    \n    \n    \n    \n  \n  \n    \n      average change in dispensary density by local characteristics\n    \n    \n      replicated for the state of Colorado\n    \n    \n      Quartile\n      Poverty Rate\n      Pct. Black\n      Pct. Hispanic\n      Employment\n      Colorado Average\n    \n  \n  \n    1\n0.072\n0.159\n0.163\n0.500\n\n    2\n0.140\n0.269\n0.049\n0.508\n\n    3\n0.150\n0.074\n0.113\n0.219\n\n    4\n0.100\n0.113\n0.134\n0.085\n\n    \n\n\n\n\n0.115"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "replicating nimby",
    "section": "",
    "text": "Home to my CIS 635 Final Project."
  },
  {
    "objectID": "Final Report_draft.html#bibliography-references.bib",
    "href": "Final Report_draft.html#bibliography-references.bib",
    "title": "Replicating NIMBY",
    "section": "bibliography: references.bib",
    "text": "bibliography: references.bib"
  },
  {
    "objectID": "Final Report_draft.html",
    "href": "Final Report_draft.html",
    "title": "replicating nimby",
    "section": "",
    "text": "::: whitebox ::: {style=“padding-left: 100px; padding-right: 100px; display: inline-block; text-align: center;”} ::: {layout-ncol=“2”}\n::: {style=“align: center;”}"
  },
  {
    "objectID": "Final Report_draft.html#works-cited",
    "href": "Final Report_draft.html#works-cited",
    "title": "replicating nimby",
    "section": "- Works Cited",
    "text": "- Works Cited\nBrinkman, J., & Mok-Lamme, D. (2019). Not in my backyard? Not so fast. The effect of marijuana legalization on neighborhood crime. Regional Science and Urban Economics, 78. https://doi-org.ezproxy.gvsu.edu/10.1016/j.regsciurbeco.2019.103460\nAnderson, D. M., & Rees, D. I. (2023). The Public Health Effects of Legalizing Marijuana. Journal of Economic Literature, 61(1), 86–143. https://doi-org.ezproxy.gvsu.edu/10.1257/jel.20211635\nHughes, Lorine A., Lonnie M. Schaible, and Katherine Jimmerson. “Marijuana Dispensaries and Neighborhood Crime and Disorder in Denver, Colorado.” Justice Quarterly, vol. 37, no. 3, 2020, pp. 461-485, doi: 10.1080/07418825.2019.1567807."
  },
  {
    "objectID": "references.html#introduction",
    "href": "references.html#introduction",
    "title": "replicating nimby",
    "section": "- Introduction",
    "text": "- Introduction\nSomewhere in my mother’s basement, is my prized 1995 tie-dyed DARE tee-shirt, a paradoxical relic of elementary classroom hours spent discussing the dangers of peer-led drug use.  Those fears were not unwarranted, the CDC (Center for Disease Control) reports that 136 Americans die daily from opioids and illicitly manufactured fentanyl1, for me - a friend or three. In my experience, most drug prevention programs portray cannabis as the catalyst to the life doomed by addiction.\nWhen recreational cannabis use became legal in Michigan, the culture shift was palpable. In an ironic twist of fate, the taboo habits of those once deamed as social deviants are now capitalized and funding K-12 education2. I am fascinated by this turn of events, and I am curious if there are predictors from more tenured “green” states that reveal unintended ill-consequences.\nIn my data mining project, I explore the relationship between the presence of cannabis dispensaries and neighborhood crime rates. By replicating the methodology of Brinkman and Mok-Lamme’s 2019 study, “Not in my backyard? Not so fast. The effect of marijuana legalization on neighborhood crime” (NIMBY), I aim to contribute a nuanced perspective on Michigan’s budding industry and how it shapes public safety and city planning.\nMy approach involved immersing myself in the wild world of crime and cannabis statistics in Colorado. Using the data sources outlined in NIMBY, I built the variables defined in NIMBY’s linear regression model, described in more detail in the methods section.\nIn line with the results in NIMBY, my findings indicate that there is no statistically significant relationship between an increased presence of cannabis dispensaries and crime."
  },
  {
    "objectID": "references.html#related-works",
    "href": "references.html#related-works",
    "title": "replicating nimby",
    "section": "- Related Works",
    "text": "- Related Works\nOne related body of work is the 2021 meta-analysis conducted by D. Mark Anderson and Daniel I. Rees’ paper “The Public Health Effects of Legalizing Marijuana.” The appendix includes a side-by-side comparison of over 70 studies related to the impact of marijuana legalization on public health outcomes by empirical strategy, and study results. This paper served as an excellent resource to understand the ways in which this topic is being studied, including the study I will replicate. The authors concluded that research around cannabis and public health outcomes are driven by the growing amount of state-level data, but the results are mixed. Further research along with careful policy design is needed to mitigate the negative impact of legalization on crime rates and other outcomes.\nHowever, the 2019 paper, “Marijuana Dispensaries and Neighborhood Crime and Disorder in Denver, Colorado” by Lorrine A. Hughes, Lonnie M. Schaible and Katherine Jimmerson found contridictory results. Their Bayesian Poisson regression model associated the presence of dispensaries with statistically significant increases in rates of neighborhood crime except for murder and auto theft."
  },
  {
    "objectID": "references.html#methods",
    "href": "references.html#methods",
    "title": "replicating nimby",
    "section": "- Methods",
    "text": "- Methods\n\nProcessing 700 dispensary business records into a single dataframe | code\nCross comparing socioeconomic factors next to dispensary growth rates | code\nCalculating dispensaries and crime per capita | code\nCreating the linear model | code"
  },
  {
    "objectID": "references.html#results-and-discussion",
    "href": "references.html#results-and-discussion",
    "title": "replicating nimby",
    "section": "- Results and Discussion",
    "text": "- Results and Discussion"
  },
  {
    "objectID": "references.html#conclusion",
    "href": "references.html#conclusion",
    "title": "replicating nimby",
    "section": "- Conclusion",
    "text": "- Conclusion"
  },
  {
    "objectID": "references.html#data-and-software",
    "href": "references.html#data-and-software",
    "title": "replicating nimby",
    "section": "- Data and Software",
    "text": "- Data and Software\n\nData Sources:\n\nColorado Department of Revenue: Medical and Retail Marijuana Licencees\nCity and County of Denver Surveyor’s Office: Denver Geographic Boundaries\nFBI Uniform Crime Reporting Program: Colorado\n2014 American Community Survey: Colorado Population, Race, Ethnicity, and Poverty Rates\n\n\n\nSoftware:\n\nRstudio\n\nPackages:\n\nfs (Hester, Wickham, and Csárdi 2021)\nlubridate (Grolemund and Wickham 2011)\nopenxlsx (Schauberger and Walker 2023)\nreadx (Wickham and Bryan 2023)\nsf (Pebesma 2018)\ntidycensus (Walker and Herman 2023)\ntidygeocoder (Cambon et al. 2021)\ntidyverse (Wickham et al. 2019)\ntigris (Walker 2023)"
  },
  {
    "objectID": "references.html#works-cited",
    "href": "references.html#works-cited",
    "title": "replicating nimby",
    "section": "- Works Cited",
    "text": "- Works Cited\nBrinkman, J., & Mok-Lamme, D. (2019). Not in my backyard? Not so fast. The effect of marijuana legalization on neighborhood crime. Regional Science and Urban Economics, 78. https://doi-org.ezproxy.gvsu.edu/10.1016/j.regsciurbeco.2019.103460\nAnderson, D. M., & Rees, D. I. (2023). The Public Health Effects of Legalizing Marijuana. Journal of Economic Literature, 61(1), 86–143. https://doi-org.ezproxy.gvsu.edu/10.1257/jel.20211635\nHughes, Lorine A., Lonnie M. Schaible, and Katherine Jimmerson. “Marijuana Dispensaries and Neighborhood Crime and Disorder in Denver, Colorado.” Justice Quarterly, vol. 37, no. 3, 2020, pp. 461-485, doi: 10.1080/07418825.2019.1567807."
  },
  {
    "objectID": "index.html#introduction",
    "href": "index.html#introduction",
    "title": "replicating nimby",
    "section": "- Introduction",
    "text": "- Introduction\nSomewhere in my mother’s basement, is my prized 1995 tie-dyed DARE tee-shirt, a paradoxical relic of elementary classroom hours spent discussing the dangers of peer-led drug use.  Those fears were not unwarranted, the CDC (Center for Disease Control) reports that 136 Americans die daily from opioids and illicitly manufactured fentanyl1, for me - a friend or three. In my experience, most drug prevention programs portray cannabis as the catalyst to the life doomed by addiction.\nWhen recreational cannabis use became legal in Michigan, the culture shift was palpable. In an ironic twist of fate, the taboo habits of those once deamed as social deviants are now capitalized and funding K-12 education2. I am fascinated by this turn of events, and I am curious if there are predictors from more tenured “green” states that reveal unintended ill-consequences.\nIn my data mining project, I explore the relationship between the presence of cannabis dispensaries and neighborhood crime rates. By replicating the methodology of Brinkman and Mok-Lamme’s 2019 study, “Not in my backyard? Not so fast. The effect of marijuana legalization on neighborhood crime” (NIMBY), I aim to contribute a nuanced perspective on Michigan’s budding industry and how it shapes public safety and city planning.\nMy approach involved immersing myself in the wild world of crime and cannabis statistics in Colorado. Using the data sources outlined in NIMBY, I built the variables defined in NIMBY’s linear regression model, described in more detail in the methods section.\nIn line with the results in NIMBY, my findings indicate that there is no statistically significant relationship between an increased presence of cannabis dispensaries and crime."
  },
  {
    "objectID": "index.html#related-works",
    "href": "index.html#related-works",
    "title": "replicating nimby",
    "section": "- Related Works",
    "text": "- Related Works\nOne related body of work is the 2021 meta-analysis conducted by D. Mark Anderson and Daniel I. Rees’ paper “The Public Health Effects of Legalizing Marijuana.” The appendix includes a side-by-side comparison of over 70 studies related to the impact of marijuana legalization on public health outcomes by empirical strategy, and study results. This paper served as an excellent resource to understand the ways in which this topic is being studied, including the study I will replicate. The authors concluded that research around cannabis and public health outcomes are driven by the growing amount of state-level data, but the results are mixed. Further research along with careful policy design is needed to mitigate the negative impact of legalization on crime rates and other outcomes.\nHowever, the 2019 paper, “Marijuana Dispensaries and Neighborhood Crime and Disorder in Denver, Colorado” by Lorrine A. Hughes, Lonnie M. Schaible and Katherine Jimmerson found contridictory results. Their Bayesian Poisson regression model associated the presence of dispensaries with statistically significant increases in rates of neighborhood crime except for murder and auto theft."
  },
  {
    "objectID": "index.html#methods",
    "href": "index.html#methods",
    "title": "replicating nimby",
    "section": "- Methods",
    "text": "- Methods\n\nProcessing 700 dispensary business records into a single dataframe | code\nCross comparing socioeconomic factors next to dispensary growth rates | code\nCalculating dispensaries and crime per capita | code\nCreating the linear model | code"
  },
  {
    "objectID": "index.html#results-and-discussion",
    "href": "index.html#results-and-discussion",
    "title": "replicating nimby",
    "section": "- Results and Discussion",
    "text": "- Results and Discussion"
  },
  {
    "objectID": "index.html#conclusion",
    "href": "index.html#conclusion",
    "title": "replicating nimby",
    "section": "- Conclusion",
    "text": "- Conclusion"
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "replicating nimby",
    "section": "",
    "text": "- Works Cited\nBrinkman, J., & Mok-Lamme, D. (2019). Not in my backyard? Not so fast. The effect of marijuana legalization on neighborhood crime. Regional Science and Urban Economics, 78. https://doi-org.ezproxy.gvsu.edu/10.1016/j.regsciurbeco.2019.103460\nAnderson, D. M., & Rees, D. I. (2023). The Public Health Effects of Legalizing Marijuana. Journal of Economic Literature, 61(1), 86–143. https://doi-org.ezproxy.gvsu.edu/10.1257/jel.20211635\nHughes, Lorine A., Lonnie M. Schaible, and Katherine Jimmerson. “Marijuana Dispensaries and Neighborhood Crime and Disorder in Denver, Colorado.” Justice Quarterly, vol. 37, no. 3, 2020, pp. 461-485, doi: 10.1080/07418825.2019.1567807.\n\n\nImage Credit:\nartist: “moomusician”, vectorstock.com\n\n\nData Sources:\n\nColorado Department of Revenue: Medical and Retail Marijuana Licencees\nCity and County of Denver Surveyor’s Office: Denver Geographic Boundaries\nFBI Uniform Crime Reporting Program: Colorado\n2014 American Community Survey: Colorado Population, Race, Ethnicity, and Poverty Rates\n\n\n\nSoftware:\n\nRstudio\n\nPackages:\n\nfs (Hester, Wickham, and Csárdi 2021)\nlubridate (Grolemund and Wickham 2011)\nopenxlsx (Schauberger and Walker 2023)\nreadx (Wickham and Bryan 2023)\nsf (Pebesma 2018)\ntidycensus (Walker and Herman 2023)\ntidygeocoder (Cambon et al. 2021)\ntidyverse (Wickham et al. 2019)\ntigris (Walker 2023)\n\n\n\n\n\n\n\n\nReferences\n\nCambon, Jesse, Diego Hernangómez, Christopher Belanger, and Daniel Possenriede. 2021. “Tidygeocoder: An r Package for Geocoding” 6: 3544. https://doi.org/10.21105/joss.03544.\n\n\nGrolemund, Garrett, and Hadley Wickham. 2011. “Dates and Times Made Easy with Lubridate” 40. https://www.jstatsoft.org/v40/i03/.\n\n\nHester, Jim, Hadley Wickham, and Gábor Csárdi. 2021. “Fs: Cross-Platform File System Operations Based on ’Libuv’.” https://CRAN.R-project.org/package=fs.\n\n\nPebesma, Edzer. 2018. “Simple Features for r: Standardized Support for Spatial Vector Data” 10. https://doi.org/10.32614/RJ-2018-009.\n\n\nSchauberger, Philipp, and Alexander Walker. 2023. “Openxlsx: Read, Write and Edit Xlsx Files.” https://CRAN.R-project.org/package=openxlsx.\n\n\nWalker, Kyle. 2023. “Tigris: Load Census TIGER/Line Shapefiles.” https://CRAN.R-project.org/package=tigris.\n\n\nWalker, Kyle, and Matt Herman. 2023. “Tidycensus: Load US Census Boundary and Attribute Data as ’Tidyverse’ and ’Sf’-Ready Data Frames.” https://CRAN.R-project.org/package=tidycensus.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the Tidyverse” 4: 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, and Jennifer Bryan. 2023. “Readxl: Read Excel Files.” https://CRAN.R-project.org/package=readxl."
  },
  {
    "objectID": "counting_dispensaries_step1.html",
    "href": "counting_dispensaries_step1.html",
    "title": "replicating nimby",
    "section": "",
    "text": "This code: creates a dataframe of dispensaries from 2013 - 2023\nThis section of my methodology was the most time intensive. Having quality historical data is the foundation of my project. Calculating the number of dispensaries is a key variable for the linear regression model."
  },
  {
    "objectID": "Label the Dispensaries with GeoCodes_step2.html#year-over-year-function",
    "href": "Label the Dispensaries with GeoCodes_step2.html#year-over-year-function",
    "title": "replicating nimby",
    "section": "year-over-year function",
    "text": "year-over-year function\nOne of former professors told me, if you have do write something three times then it’s time to write a function! The year over year variance is another crucial aspect of NIMBY’s model. This function will be applied to several variables\n\n\nCode\n# make a function to calculate the year over year changes\nyoy_avg_function <- function(df) {\n  # calculate  growth rates\n  df$yoy_2014 <- ((df$`2014` - df$`2013`) / df$`2013`) \n  df$yoy_2015 <- ((df$`2015` - df$`2014`) / df$`2014`) \n  df$yoy_2016 <- ((df$`2016` - df$`2015`) / df$`2015`) \n  \n  # average growth rate and round to 3 decimal places\n  df$dsp_yoy_avg <- rowMeans(df[, c(\"yoy_2014\", \"yoy_2015\", \"yoy_2016\")], na.rm = TRUE)\n  df <- df %>% mutate_at(vars(starts_with(\"dsp\")), funs(round(., 3))) # round\n  \n  return(df)\n}\n\n\n\n\n\ncalculate the year-over-year change average in dispensaries for the state of Colorado\n\n\nCode\ncolorado_yoy_average <-  dsps_yoy_demos %>% \n  summarize(\n    `2013` = sum(`2013`),\n    `2014` = sum(`2014`),\n    `2015` = sum(`2015`),\n    `2016` = sum(`2016`)\n  )\n\ncolorado_yoy_average <-  yoy_avg_function(colorado_yoy_average) %>% \n  select(\"Colorado Average\" = dsp_yoy_avg)\n\n\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n\n\n\n\nfind the race, poverty and employment rates at the county level\n\n\nCode\n# make the rates\n# create the percentages:\ndsps_yoy_demos  <- dsps_yoy_demos %>% \n  #create percentages  \n  mutate(pct_poverty_rate = (pov_pop_14/pov_base),\n         pct_black = (black_pop/ pop_2014),\n         pct_hispanic = (hispanic_pop/ pop_2014)) %>% \n  #round\n  mutate_at(vars(starts_with(\"pct\")), funs(round(., 3)))\n\n\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n\n\n\n\ncreate quartiles to recreate table1\n\n\n\ntable1 from the original paper is my second reference at cross comparing my results against NIMBY’s\n\n\nUsing the ntile function, I classify the dispensary year-over-year changes by counties quartiles of the various variables\n\n\nCode\ndsps_yoy_demos <- dsps_yoy_demos %>% \n  mutate(qrt_pov = ntile(pct_poverty_rate,4)) %>% \n  mutate(qrt_black = ntile(pct_black,4)) %>%\n  mutate(qrt_hispanic = ntile(pct_hispanic,4)) %>% \n  mutate(qrt_employment = ntile(employeed_pop,4))\n\n# calculate the YOY average\ndsps_yoy_qtiles <- yoy_avg_function(dsps_yoy_demos) \n\n\nWarning: `funs()` was deprecated in dplyr 0.8.0.\nℹ Please use a list of either functions or lambdas:\n\n# Simple named list: list(mean = mean, median = median)\n\n# Auto named with `tibble::lst()`: tibble::lst(mean, median)\n\n# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))\n\n\nCode\n# save the data for the crime per capita calculations\nwrite.csv(dsps_yoy_qtiles, \"~/gvsu/winter 23/CIS 635/NIMBY/cleaning/counting_dispensaries/dps_data_cleaned/dsps_yoy_qtiles.csv\")\n\n\n\n\nTransform the data into a tabluar format to be presented in a simple summarized table\n\n\nCode\n# poverty quartiles by dispensary density\npoverty_qts <- dsps_yoy_qtiles %>% \n  select(\n    qrt_pov,\n    `2013`,\n    `2014`,\n    `2015`,\n    `2016`\n      ) %>% \n  group_by(qrt_pov) %>% # add the total ins\n  summarize(\n    `2013` = sum(`2013`),\n    `2014` = sum(`2014`),\n    `2015` = sum(`2015`),\n    `2016` = sum(`2016`)\n  ) %>% \n  yoy_avg_function  %>% \n  select(1,9)\n  \n\n# I checked and my total match across quartiles, and look similar to the area graph data\n# black population quartiles by dispensary density\nblack_qts <- dsps_yoy_qtiles %>% \n  select(\n    qrt_black,\n    `2013`,\n    `2014`,\n    `2015`,\n    `2016`\n  ) %>% \n  group_by(qrt_black) %>% # add the total ins\n  summarize(\n    `2013` = sum(`2013`),\n    `2014` = sum(`2014`),\n    `2015` = sum(`2015`),\n    `2016` = sum(`2016`)\n  ) %>% \n  yoy_avg_function  %>% \n  select(1,9)\n\n# Hispanic quartiles by dispensary density\nhispanic_qts <- dsps_yoy_qtiles %>% \n  select(\n    qrt_hispanic,\n    `2013`,\n    `2014`,\n    `2015`,\n    `2016`\n  ) %>% \n  group_by(qrt_hispanic) %>% # add the total ins\n  summarize(\n    `2013` = sum(`2013`),\n    `2014` = sum(`2014`),\n    `2015` = sum(`2015`),\n    `2016` = sum(`2016`)\n  ) %>% \n  yoy_avg_function  %>% \n  select(1,9)\n\n# employment quartiles by dispensary density\nemployment_qts <- dsps_yoy_qtiles %>% \n  select(\n    qrt_employment,\n    `2013`,\n    `2014`,\n    `2015`,\n    `2016`\n    ) %>% \n    group_by(qrt_employment) %>% # add the total ins\n      summarize(\n        `2013` = sum(`2013`),\n        `2014` = sum(`2014`),\n        `2015` = sum(`2015`),\n        `2016` = sum(`2016`)\n      ) %>% \n  yoy_avg_function  %>% \n  select(1,9)\n\n\n\n\ncreate a table of all my variables:\n\n\nCode\n# put everything together \ndensity_table1 <- poverty_qts %>%\n  left_join(black_qts, by = c(\"qrt_pov\" = \"qrt_black\")) %>%\n  left_join(hispanic_qts, by = c(\"qrt_pov\" = \"qrt_hispanic\")) %>%\n  left_join(employment_qts, by = c(\"qrt_pov\" = \"qrt_employment\"))\n\n\n# rename the columns\ncolnames(density_table1) <- c(\"Quartile\", \"Poverty Rate\", \"Pct. Black\", \"Pct. Hispanic\", \"Employment\", \"Colorado Average\")\ncombined_table <- bind_rows(density_table1 , colorado_yoy_average)"
  }
]